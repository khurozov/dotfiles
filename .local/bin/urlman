#!/usr/bin/env bash

set -euo pipefail

ifinstalled fuzzel

file="$HOME/.local/share/urls"
test -f "$file"

select_url() {
    grep -v -E '^#|^\s*$' "$file" | fuzzel -Rdw 100 -p "$1"
}
open_url() {
    url="$(select_url "open: ")"

    $BROWSER "${url%% *}"
}

private_url() {
    url="$(select_url "private: ")"

    $BROWSER --incognito "${url%% *}"
}

edit_urls() {
    xdg-open "$file"
}

help_cmd() {
    echo "urlman - URL Manager

Usage: urlman <command>

command:
    open        open url
    private     open url in private window
    edit        edit url file"
}

case "$1" in
    open)       open_url;;
    private)    private_url;;
    edit)       edit_urls;;
    *)          help_cmd;;
esac
